#!/usr/bin/env -S java --source 25

/**
 * zcbs - Zero dependencies Clipboard Saver
 */

import java.awt.Toolkit;
import java.awt.datatransfer.DataFlavor;
import java.nio.file.Files;
import java.nio.file.Path;

enum Log {

    ERROR(Color.RED, System.err),
    INFO(Color.GREEN, System.out),
    SUCCESS(Color.MAGENTA, System.out),
    DIMMED(Color.DIM, System.out);

    PrintStream out;

    enum Color {
        RED("\033[38;2;220;50;47m"),          // Solarized Red #dc322f
        MAGENTA("\033[38;2;211;54;130m"),     // Solarized Magenta #d33682
        GREEN("\033[38;2;133;153;0m"),        // Solarized Green #859900
        DIM("\033[2m");                        // Dimmed text

        String code;

        Color(String code) {
            this.code = code;
        }
    }

    private final String value;
    private final static String RESET = "\u001B[0m";

    private Log(Color color, PrintStream out) {
        this.value = (color.code + "%s" + RESET);
        this.out = out;
    }

    public void out(String message) {
        var colored = this.value.formatted(message);
        this.out.println(colored);
    }

    public static void error(String message) {
        Log.ERROR.out(message);
    }

    public static void info(String message){
        Log.INFO.out(message);
    }

    public static void success(String message){
        Log.SUCCESS.out(message);
    }

    public static void dimmed(String message){
        Log.DIMMED.out(message);
    }

    public static void stop(String message){
        error(message);
        System.exit(0);
    }
}

String version = "2026-02-26.2";

void main(String... args) {
    Log.info("zcbs %s%n".formatted(version));
    if (args.length == 0) {
        Log.info("Usage: zcbs <filename>");
        return;
    }

    var filename = args[0];
    var rawContent = clipboardContent();
    var content = sanitize(rawContent);
    var path = Path.of(filename);

    try {
        Files.writeString(path, content);
        Log.dimmed(content);
        Log.success("Clipboard saved to: " + path.toAbsolutePath());
    } catch (Exception e) {
        Log.stop("Failed to write file: " + e.getMessage());
    }
}

String sanitize(String input){
    return input.lines()
         .map(String::trim)
         .collect(Collectors.joining(System.lineSeparator()));
    
}

String clipboardContent() {
    try {
        var clipboard = Toolkit.getDefaultToolkit().getSystemClipboard();
        return (String) clipboard.getData(DataFlavor.stringFlavor);
    } catch (Exception e) {
        Log.stop("Failed to read clipboard: " + e.getMessage());
        return "";
    }
}
